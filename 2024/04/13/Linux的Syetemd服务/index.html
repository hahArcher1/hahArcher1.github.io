<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Linux的Syetemd服务 | 哆啦酱的点心屋</title><meta name="author" content="爱吃铜锣烧的哆啦酱"><meta name="copyright" content="爱吃铜锣烧的哆啦酱"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="背景在Linux操作系统中，系统会首先启动init daemon (pid &#x3D; 1)做为第一个进程，其以守护进程的形式在系统中运行，直到系统关闭。守护进程一种在后台执行，而不由用户直接交互控制的程序。init daemon可以作为其他所有进程的父进程，来管理所有其他进程的启动。 在Centos7之前，是通过Init架构（又被称为System V Init或SysVinit）来实现init daem">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux的Syetemd服务">
<meta property="og:url" content="https://haharcher1.github.io/2024/04/13/Linux%E7%9A%84Syetemd%E6%9C%8D%E5%8A%A1/index.html">
<meta property="og:site_name" content="哆啦酱的点心屋">
<meta property="og:description" content="背景在Linux操作系统中，系统会首先启动init daemon (pid &#x3D; 1)做为第一个进程，其以守护进程的形式在系统中运行，直到系统关闭。守护进程一种在后台执行，而不由用户直接交互控制的程序。init daemon可以作为其他所有进程的父进程，来管理所有其他进程的启动。 在Centos7之前，是通过Init架构（又被称为System V Init或SysVinit）来实现init daem">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images0b5f3510de09418d98baaedffe1a7f3b.jpg">
<meta property="article:published_time" content="2024-04-13T08:17:56.000Z">
<meta property="article:modified_time" content="2024-04-14T06:24:55.738Z">
<meta property="article:author" content="爱吃铜锣烧的哆啦酱">
<meta property="article:tag" content="Linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images0b5f3510de09418d98baaedffe1a7f3b.jpg"><link rel="shortcut icon" href="/img/favicon2.png"><link rel="canonical" href="https://haharcher1.github.io/2024/04/13/Linux%E7%9A%84Syetemd%E6%9C%8D%E5%8A%A1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体中文","cht_to_chs":"你已切换为简体中文","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux的Syetemd服务',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-14 14:24:55'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (false) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/download/"><i class="fa-fw fas fa-download"></i><span> 资源</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/About/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images0b5f3510de09418d98baaedffe1a7f3b.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="哆啦酱的点心屋"><span class="site-name">哆啦酱的点心屋</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 相册</span></a></li><li><a class="site-page child" href="/download/"><i class="fa-fw fas fa-download"></i><span> 资源</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/About/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linux的Syetemd服务</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-13T08:17:56.000Z" title="发表于 2024-04-13 16:17:56">2024-04-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-14T06:24:55.738Z" title="更新于 2024-04-14 14:24:55">2024-04-14</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0/">技术学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>28分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux的Syetemd服务"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>在Linux操作系统中，系统会首先启动<code>init daemon (pid = 1)</code>做为第一个进程，其以守护进程的形式在系统中运行，直到系统关闭。守护进程一种在后台执行，而不由用户直接交互控制的程序。<code>init daemon</code>可以作为其他所有进程的父进程，来管理所有其他进程的启动。</p>
<p>在<code>Centos7</code>之前，是通过<code>Init</code>架构（又被称为System V Init或SysVinit）来实现<code>init daemon</code>如<code>Centos6</code>，而现在<code>Centos</code>系统一般都是以<code>Systemd</code>架构来实现<code>init daemon</code>。我们可以通过<code>pstree -p</code>命令来查看进程树。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y install psmisc</span><br><span class="line">pstree -p</span><br><span class="line">[root@www ~]# pstree -p</span><br><span class="line">systemd(1)─┬─NetworkManager(696)─┬─&#123;NetworkManager&#125;(714)</span><br><span class="line">           │                     └─&#123;NetworkManager&#125;(716)</span><br><span class="line">           ├─agetty(713)</span><br><span class="line">           ├─atd(703)</span><br><span class="line">           ├─auditd(665)───&#123;auditd&#125;(666)</span><br><span class="line">           ├─crond(705)</span><br><span class="line">           ├─dbus-daemon(691)</span><br><span class="line">           ├─httpd(934)─┬─httpd(1476)</span><br><span class="line">           │            ├─httpd(1477)</span><br><span class="line">           │            ├─httpd(1478)</span><br><span class="line">           │            ├─httpd(1479)</span><br><span class="line">           │            └─httpd(1480)</span><br><span class="line">           ├─irqbalance(689)</span><br><span class="line">           ├─lvmetad(539)</span><br><span class="line">           ├─master(1248)─┬─pickup(1279)</span><br><span class="line">           │              └─qmgr(1280)</span><br><span class="line">           ├─mysqld_safe(1084)───mysqld(1291)─┬─&#123;mysqld&#125;(1457)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1458)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1459)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1460)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1461)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1462)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1463)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1464)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1465)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1466)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1468)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1469)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1470)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1471)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1472)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1473)</span><br><span class="line">           │                                  ├─&#123;mysqld&#125;(1637)</span><br><span class="line">           │                                  └─&#123;mysqld&#125;(1638)</span><br><span class="line">           ├─polkitd(688)─┬─&#123;polkitd&#125;(695)</span><br><span class="line">           │              ├─&#123;polkitd&#125;(699)</span><br><span class="line">           │              ├─&#123;polkitd&#125;(702)</span><br><span class="line">           │              ├─&#123;polkitd&#125;(706)</span><br><span class="line">           │              ├─&#123;polkitd&#125;(707)</span><br><span class="line">           │              └─&#123;polkitd&#125;(708)</span><br><span class="line">           ├─rsyslogd(938)─┬─&#123;rsyslogd&#125;(1019)</span><br><span class="line">           │               └─&#123;rsyslogd&#125;(1074)</span><br><span class="line">           ├─sshd(933)───sshd(1647)───bash(1650)───pstree(1691)</span><br><span class="line">           ├─systemd-journal(513)</span><br><span class="line">           ├─systemd-logind(698)</span><br><span class="line">           ├─systemd-udevd(547)</span><br><span class="line">           ├─tuned(935)─┬─&#123;tuned&#125;(1625)</span><br><span class="line">           │            ├─&#123;tuned&#125;(1626)</span><br><span class="line">           │            ├─&#123;tuned&#125;(1628)</span><br><span class="line">           │            └─&#123;tuned&#125;(1636)</span><br><span class="line">           └─vsftpd(940)</span><br></pre></td></tr></table></figure>
<p>我使用的是<code>centos7.9</code>，因此<code>systemd(1)</code>是第一个进程，作为所有其他进程的父进程。因为最近在学习中看到了相关的命令，所以在这里学习记录一下。</p>
<h1 id="Init架构"><a href="#Init架构" class="headerlink" title="Init架构"></a>Init架构</h1><h2 id="系统的运行级别"><a href="#系统的运行级别" class="headerlink" title="系统的运行级别"></a>系统的运行级别</h2><p>在<code>Init</code>架构中存在<code>7</code>个运行级别：</p>
<table>
<thead>
<tr>
<th align="center">级别</th>
<th align="center">功能</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>0</code></td>
<td align="center">Shutdown（关机）</td>
</tr>
<tr>
<td align="center"><code>1</code></td>
<td align="center">Single User Mode（单用户模式）</td>
</tr>
<tr>
<td align="center"><code>2</code></td>
<td align="center">Multiuser mode without networking（断网多用户模式）</td>
</tr>
<tr>
<td align="center"><code>3</code></td>
<td align="center">Multiuser mode with networking（联网多用户模式）默认</td>
</tr>
<tr>
<td align="center"><code>4</code></td>
<td align="center">Unused（未使用）</td>
</tr>
<tr>
<td align="center"><code>5</code></td>
<td align="center">Multiuser mode with networking and GUI（图形化界面的联网多用户模式）</td>
</tr>
<tr>
<td align="center"><code>6</code></td>
<td align="center">Reboot（重启）</td>
</tr>
</tbody></table>
<p>配置文件<code>/etc/inittab</code>决定以哪种方式运行系统，它是系统在启动<code>init daemon</code>时读取的第一个文件，默认是以<code>3</code>来启动。当然对于<code>Centos7</code>来说，这个文件已经没有用了，文件内容：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www ~]# cat /etc/inittab</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">inittab is no longer used when using systemd.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># ADDING CONFIGURATION HERE WILL HAVE NO EFFECT ON YOUR SYSTEM.</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Ctrl-Alt-Delete is handled by /usr/lib/systemd/system/ctrl-alt-del.target</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># systemd uses &#x27;targets&#x27; instead of runlevels. By default, there are two main targets:</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># multi-user.target: analogous to runlevel 3</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">graphical.target: analogous to runlevel 5</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># To view current default target, run:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl get-default</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># To set a default target, run:</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">systemctl set-default TARGET.target</span></span><br></pre></td></tr></table></figure>
<h2 id="Init架构的服务"><a href="#Init架构的服务" class="headerlink" title="Init架构的服务"></a>Init架构的服务</h2><p>在<code>Centos6</code>，可以通过<code>service</code>命令来启动相应的服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>
<p>在<code>/etc/rc.d/init.d</code>存放着能够通过<code>service</code>命令管理的服务，通过按照相应的规则编写好对应的脚本，放到<code>/etc/rc.d/init.d</code>里面，就可以通过<code>service</code>命令来管理。在<code>/etc/rc.d/</code>文件夹里面，还存在<code>/etc/rc.d/rc&#123;0..6&#125;.d</code>文件夹，其中数字就是对应于<code>Init</code>架构中的<code>7</code>个级别，当系统以相应的级别开机或关机的时候，就会直接启动对应那个级别的文件夹里面的脚本。在<code>/etc</code>下存在软链接指向这几个目录：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www etc]# ll init.d rc&#123;0..6&#125;.d rc.local -d</span><br><span class="line">lrwxrwxrwx. 1 root root 11 Apr  9 13:33 init.d -&gt; rc.d/init.d</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Apr  9 13:33 rc0.d -&gt; rc.d/rc0.d</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Apr  9 13:33 rc1.d -&gt; rc.d/rc1.d</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Apr  9 13:33 rc2.d -&gt; rc.d/rc2.d</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Apr  9 13:33 rc3.d -&gt; rc.d/rc3.d</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Apr  9 13:33 rc4.d -&gt; rc.d/rc4.d</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Apr  9 13:33 rc5.d -&gt; rc.d/rc5.d</span><br><span class="line">lrwxrwxrwx. 1 root root 10 Apr  9 13:33 rc6.d -&gt; rc.d/rc6.d</span><br><span class="line">lrwxrwxrwx. 1 root root 13 Apr  9 13:34 rc.local -&gt; rc.d/rc.local</span><br></pre></td></tr></table></figure>
<p>我们以级别<code>3</code>为例，查看相应的文件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www rc3.d]# pwd</span><br><span class="line">/etc/rc.d/rc3.d</span><br><span class="line">[root@www rc3.d]# ll</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx. 1 root root 20 Apr  9 13:34 K50netconsole -&gt; ../init.d/netconsole</span><br><span class="line">lrwxrwxrwx. 1 root root 17 Apr  9 13:34 S10network -&gt; ../init.d/network</span><br></pre></td></tr></table></figure>
<p>可以看到这里面的文件，其实<code>/etc/rc.d/init.d</code>中脚本的软链接，并且名字也有所不同，原因在于<code>Init</code>架构在执行相应的脚本时，是根据脚本的名字来执行的即：</p>
<ul>
<li>S：即Start，系统开机时执行</li>
<li>K：即Kill，系统关机时执行</li>
<li>数字：执行的顺序</li>
<li>最后才是脚本的名字<br>虽然自从<code>Centos7</code>后，就有<code>Systemd</code>架构来代替<code>Init</code>架构，但是在<code>Centos7</code>中依然兼容了<code>Init</code>架构。</li>
</ul>
<h2 id="Init架构的启动"><a href="#Init架构的启动" class="headerlink" title="Init架构的启动"></a>Init架构的启动</h2><p>当我们打开给Linux系统的电脑开机的时候，BIOS 会从非易失性存储器中加载，并执行上电自检，之后BIOS会检测系统资源，然后会查找硬盘的主引导记录（MBR），MBR会初始化引导程序如GRBU，GRUB加载内核，内核会执行<code>/sbin/init</code>程序，其就会成为<code>Pid = 1</code>的所有Linux进程的父进程，然后<code>/sbin/init</code>会读取<code>/etc/inittab</code>文件，确定操作系统的运行级别，从文件<code>/etc/fstab</code>里查找分区表信息进行相应的挂载，然后按照运行级别执行<code>/etc/rc.d/rcX.d</code>里面的脚本，按顺序一个一个执行，每次只启动一个服务。关机过程差不多是相反，首先<code>Init</code>停止所有服务，最后阶段会卸载文件系统。</p>
<h1 id="Systemd架构"><a href="#Systemd架构" class="headerlink" title="Systemd架构"></a>Systemd架构</h1><p>一直以来，<code>Centos</code>都是采用<code>Init</code>架构，但是<code>Init</code>架构启动慢，需要串行启动，即进程是一个接着一个启动，只有当前一个进程启动成功，才会去启动下一个进程，同时启动进程的脚本比较复杂，因此<code>Centos7</code>之后，<code>Systemd</code>架构取代了<code>Init</code>架构，其可以做到并行启动，减少系统引导时间和计算开销。同时其为系统的启动和管理提供了完整的解决方案，如下图所示，<code>Systemd</code>架构及其复杂。<br><img src="1.png"></p>
<h2 id="Systemd-unit"><a href="#Systemd-unit" class="headerlink" title="Systemd unit"></a>Systemd unit</h2><p><code>Systemd</code>可以管理系统的所有资源，并把这些资源统一称为<code>unit</code>。对应的<code>unit</code>有12种。</p>
<h2 id="unit-分类"><a href="#unit-分类" class="headerlink" title="unit 分类"></a>unit 分类</h2><table>
<thead>
<tr>
<th align="center"><code>unit</code>类型</th>
<th align="center">文件后缀</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>Service</code></td>
<td align="center"><code>.service</code></td>
<td align="center">系统服务，包括启动，重启，关闭服务的相关指令</td>
</tr>
<tr>
<td align="center"><code>Target</code></td>
<td align="center"><code>.target</code></td>
<td align="center">定义了一组<code>unit</code>的集合，一般作为<code>unit</code>启动的同步点，某个<code>Target</code>启动成功对应着一组相关的<code>Service</code>启动成功</td>
</tr>
<tr>
<td align="center"><code>Automount</code></td>
<td align="center"><code>.automount</code></td>
<td align="center">系统引导时会进行自动挂载的挂载点</td>
</tr>
<tr>
<td align="center"><code>Mount</code></td>
<td align="center"><code>.mount</code></td>
<td align="center">由<code>systemd</code>管理的文件系统挂载点</td>
</tr>
<tr>
<td align="center"><code>Path</code></td>
<td align="center"><code>.path</code></td>
<td align="center">定义了一条用于基于路径激活服务的文件路径。例如，可以基于某一条文件路径的状态（是否存在等）来启动某个服务。</td>
</tr>
<tr>
<td align="center"><code>Scope</code></td>
<td align="center"><code>.scope</code></td>
<td align="center">定义了来自<code>systemd</code>总线接口的信息，通常用来管理额外的系统进程</td>
</tr>
<tr>
<td align="center"><code>Slice</code></td>
<td align="center"><code>.slice</code></td>
<td align="center">定义了资源限额，基于<code>Linux cgroup nodes</code>实现。</td>
</tr>
<tr>
<td align="center"><code>Snapshot</code></td>
<td align="center"><code>.snapshot</code></td>
<td align="center">当前的<code>systemd</code>状态，通常在对<code>systemd</code>做修改后回滚使用</td>
</tr>
<tr>
<td align="center"><code>Socket</code></td>
<td align="center"><code>.socket</code></td>
<td align="center">定义了进程间通信使用的<code>socket</code>，往往<code>socket</code>会与<code>service</code>相关联</td>
</tr>
<tr>
<td align="center"><code>Swap</code></td>
<td align="center"><code>.swap</code></td>
<td align="center">定义了系统中的交换空间</td>
</tr>
<tr>
<td align="center"><code>Timer</code></td>
<td align="center"><code>.timer</code></td>
<td align="center">定义了一个定时激活另一个单元的定时器</td>
</tr>
</tbody></table>
<h2 id="unit-的存放路径"><a href="#unit-的存放路径" class="headerlink" title="unit 的存放路径"></a>unit 的存放路径</h2><table>
<thead>
<tr>
<th align="center">路径</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>/etc/systemd/system</code></td>
<td align="center">由<code>systemctl enable</code>命令创建的<code>systemd unit</code>文件将存放在此处，实际上是指向<code>/usr/lib/systemd/system</code>的软链接。系统管理员自定义的<code>unit</code>也存放在该目录下。默认在这里读取文件</td>
</tr>
<tr>
<td align="center"><code>/run/systemd/system</code></td>
<td align="center">服务运行时产生的相关<code>unit</code>都存放在这个目录下</td>
</tr>
<tr>
<td align="center"><code>/usr/lib/systemd/system</code></td>
<td align="center">系统或第三方软件安装时添加的<code>unit</code>放在这个目录下</td>
</tr>
</tbody></table>
<h2 id="常用的unit"><a href="#常用的unit" class="headerlink" title="常用的unit"></a>常用的unit</h2><p>可以利用<code>man 5 systemd.unit类型</code>去查看帮助文档，如<code>man 5 systemd.slice</code>，里面包括怎么写配置文件。这里简单介绍一下常用的<code>unit</code>，包括<code>Service</code>和<code>Target</code>。</p>
<h3 id="Service-简单介绍"><a href="#Service-简单介绍" class="headerlink" title="Service 简单介绍"></a>Service 简单介绍</h3><p><code>Service</code>类型是最常用的<code>unit</code>，主要是用来启动像<code>httpd</code>和<code>sshd</code>这样的服务的配置文件，对应的文件名是<code>httpd.service</code>和<code>ssh.d.service</code>，可以使用<code>systemctl cat sshd.service</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www etc]# systemctl cat sshd.service</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/lib/systemd/system/sshd.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=OpenSSH server daemon</span><br><span class="line">Documentation=man:sshd(8) man:sshd_config(5)</span><br><span class="line">After=network.target sshd-keygen.service</span><br><span class="line">Wants=sshd-keygen.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=/etc/sysconfig/sshd</span><br><span class="line">ExecStart=/usr/sbin/sshd -D $OPTIONS</span><br><span class="line">ExecReload=/bin/kill -HUP $MAINPID</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=42s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>可以看到比较多字段，接下来我们简单了解一下：<br><code># /usr/lib/systemd/system/sshd.service</code>给出了对应的路径，一个<code>unit</code>包括三个字段<code>[Unit]</code>，<code>[Install]</code>和<code>[Unit类型]</code>，这里<code>Service</code>类型对应的就是<code>[Service]</code></p>
<ul>
<li><code>[Unit]</code>：定义了<code>unit</code>的基本信息，以及配置与其他<code>unit</code>的关系，表现为键值对的形式，其主要字段如下：<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Description：简短描述</span><br><span class="line">Documentation：文档地址</span><br><span class="line">Requires：当前 unit 依赖的其他 unit，如果它们没有运行，当前 unit 会启动失败</span><br><span class="line">Wants：与当前 unit 配合的其他 unit，如果它们没有运行，当前 unit 不会启动失败</span><br><span class="line">BindsTo：与Requires类似，它指定的 unit 如果退出，会导致当前 unit 停止运行</span><br><span class="line">Before：如果该字段指定的 unit 也要启动，那么必须在当前 unit 之后启动</span><br><span class="line">After：如果该字段指定的 unit 也要启动，那么必须在当前 unit 之前启动</span><br><span class="line">Conflicts：这里指定的 unit 不能与当前 unit 同时运行</span><br><span class="line">Condition...：当前 unit 运行必须满足的条件，否则不会运行</span><br><span class="line">Assert...：当前 unit 运行必须满足的条件，否则会报启动失败</span><br></pre></td></tr></table></figure>
对于<code>sshd.service</code>，<code>Description=OpenSSH server daemon</code>给出了简单描述，<code>Documentation=man:sshd(8) man:sshd_config(5)</code>给出了文档信息，<code>After=network.target sshd-keygen.service</code>表明如果<code>network.target</code>或<code>sshd-keygen.service</code>要启动，那么<code>sshd.service</code>需要在这两个之后启动。<code>Wants=sshd-keygen.service</code>表明<code>sshd.service</code>和<code>sshd-keygen.service</code>有弱依赖关系，即使<code>sshd-keygen.service</code>未启动，启动失败或者停止服务也不会影响<code>sshd.service</code>的运行。</li>
<li><code>[Service]</code>：定义了<code>unit</code>的服务配置：<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Type：定义启动时的进程行为。它有以下几种值。</span><br><span class="line">Type=simple：默认值，执行ExecStart指定的命令，启动主进程</span><br><span class="line">Type=forking：以 fork 方式从父进程创建子进程，创建后父进程会立即退出</span><br><span class="line">Type=oneshot：一次性进程，Systemd 会等当前服务退出，再继续往下执行</span><br><span class="line">Type=dbus：当前服务通过D-Bus启动</span><br><span class="line">Type=notify：当前服务启动完毕，会通知Systemd，再继续往下执行</span><br><span class="line">Type=idle：若有其他任务执行完毕，当前服务才会运行</span><br><span class="line">ExecStart：启动当前服务的命令</span><br><span class="line">ExecStartPre：启动当前服务之前执行的命令</span><br><span class="line">ExecStartPost：启动当前服务之后执行的命令</span><br><span class="line">ExecReload：重启当前服务时执行的命令</span><br><span class="line">ExecStop：停止当前服务时执行的命令</span><br><span class="line">ExecStopPost：停止当其服务之后执行的命令</span><br><span class="line">RestartSec：自动重启当前服务间隔的秒数</span><br><span class="line">Restart：定义何种情况 Systemd 会自动重启当前服务，可能的值包括always（总是重启）、on-success、on-failure、on-abnormal、on-abort、on-watchdog、no。no（默认值）：退出后不会重启，on-success：只有正常退出时（退出状态码为0），才会重启，on-failure：非正常退出时（退出状态码非0），包括被信号终止和超时，才会重启，on-abnormal：只有被信号终止和超时，才会重启，on-abort：只有在收到没有捕捉到的信号终止时，才会重启，on-watchdog：超时退出，才会重启，always：不管是什么退出原因，总是重启</span><br><span class="line">TimeoutSec：定义 Systemd 停止当前服务之前等待的秒数</span><br><span class="line">Environment：指定环境变量</span><br><span class="line">EnvironmentFile：指定加载一个包含服务所需的环境变量列表的文件，文件中的每一行都是一个环境变量的定义</span><br><span class="line">KillMode：定义 Systemd 如何停止 sshd 服务。可以设置为：control-group（默认值）：当前控制组里面的所有子进程，都会被杀掉，process：只杀主进程，mixed：主进程将收到 SIGTERM 信号，子进程收到 SIGKILL 信号，none：没有进程会被杀掉，只是执行服务的 stop 命令。</span><br></pre></td></tr></table></figure>
对于<code>sshd.service</code>，<code>Type=notify</code>表明当前服务启动完毕，会通知<code>Systemd</code>，再继续往下执行，<code>EnvironmentFile=/etc/sysconfig/sshd</code>从配置文件<code>/etc/sysconfig/sshd</code>中获取环境变量，最重要的就是这个执行命令<code>ExecStart=/usr/sbin/sshd -D $OPTIONS</code>，重启当前服务时执行的命令为<code>ExecReload=/bin/kill -HUP $MAINPID</code>，<code>KillMode=process</code>表示只停止主进程，不停止任何<code>sshd</code>子进程，即子进程打开的 <code>SSH session</code>仍然保持连接。这个设置不太常见，但对<code>sshd</code>很重要，否则你停止服务的时候，会连自己打开的 <code>SSH session</code>一起杀掉。<code>Restart=on-failure</code>表明出现任何意外的失败都重启，<code>RestartSec=42s</code>表明在重启<code>sshd</code>服务之前要等待<code>42s</code>。</li>
<li><code>[Install]</code><br>用来定义如何启动，以及是否开机启动<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">WantedBy：它的值是一个或多个 Target，当前 unit 设置为开机启动时，软链接会放入/etc/systemd/system目录下面以 Target 名 + .wants后缀构成的子目录中，表示该服务所在的Target</span><br><span class="line">RequiredBy：它的值是一个或多个 Target，当前 unit 开机启动时，软链接会放入/etc/systemd/system目录下面以 Target 名 + .required后缀构成的子目录中</span><br><span class="line">Alias：当前 unit 可用于启动的别名</span><br><span class="line">Also：当前 unit 激活（enable）时，会被同时激活的其他 unit</span><br></pre></td></tr></table></figure>
对于<code>sshd.service</code>，<code>WantedBy=multi-user.target</code>表明它是属于<code>multi-user.target</code>的，这个很重要，它可以设置开机自动启动，当我们用<code>systemctl enable sshd</code>时会在<code>/etc/systemd/system/multi-user.target</code>目录创建软链接到<code>/usr/lib/systemd/system/sshd.service</code>，<code>Systemd</code>默认启动的<code>Target</code>是<code>default.target</code>，而<code>default.target</code>是<code>multi-user.target</code>或<code>graphical.target</code>的软链接，可以通过<code>systemctl get-default</code>查询到。<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www etc]# systemctl get-default</span><br><span class="line">multi-user.target</span><br></pre></td></tr></table></figure>
当使用命令时，不指定<code>unit</code>类型时，默认是<code>Service</code>类型，例如<code>systemctl status sshd</code>，查看服务状态<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www init.d]# systemctl status sshd</span><br><span class="line">● sshd.service - OpenSSH server daemon </span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/sshd.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sat 2024-04-13 16:35:12 CST; 17h ago</span><br><span class="line">     Docs: man:sshd(8)</span><br><span class="line">           man:sshd_config(5)</span><br><span class="line"> Main PID: 933 (sshd)</span><br><span class="line">   CGroup: /system.slice/sshd.service</span><br><span class="line">           └─933 /usr/sbin/sshd -D</span><br><span class="line"></span><br><span class="line">Apr 13 16:35:12 www.a.org systemd[1]: Starting OpenSSH server daemon...</span><br><span class="line">Apr 13 16:35:12 www.a.org sshd[933]: Server listening on 0.0.0.0 port 22.</span><br><span class="line">Apr 13 16:35:12 www.a.org sshd[933]: Server listening on :: port 22.</span><br><span class="line">Apr 13 16:35:12 www.a.org systemd[1]: Started OpenSSH server daemon.</span><br><span class="line">Apr 13 16:35:27 www.a.org sshd[1647]: Accepted password for root from 172.16.34.145 port 2454 ssh2</span><br><span class="line">上面的输出含义：</span><br><span class="line">sshd.service行：服务的基本介绍</span><br><span class="line">Loaded行：配置文件的位置，是否设为开机启动，enabled表示开机自动启动，preset: enabled表示软件安装后默认开机自动启动。</span><br><span class="line">Active行：表示服务的运行状态为正在运行</span><br><span class="line">Docs：文档信息</span><br><span class="line">Main PID：主进程号</span><br><span class="line">CGroup块：应用的子进程</span><br><span class="line">日志块：最下面的带有时间的</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Target-简单介绍"><a href="#Target-简单介绍" class="headerlink" title="Target 简单介绍"></a>Target 简单介绍</h3><p><code>Target</code> 就是一个 <code>unit</code> 组，包含许多相关的 <code>unit</code> 。启动某个 <code>Target</code> 的时候，<code>Systemd</code> 就会启动里面所有的 <code>unit</code>。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www etc]# systemctl cat multi-user.target</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/lib/systemd/system/multi-user.target</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> This file is part of systemd.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Multi-User System</span><br><span class="line">Documentation=man:systemd.special(7)</span><br><span class="line">Requires=basic.target</span><br><span class="line">Conflicts=rescue.service rescue.target</span><br><span class="line">After=basic.target rescue.service rescue.target</span><br><span class="line">AllowIsolate=yes</span><br></pre></td></tr></table></figure>
<p><code>Target</code>也有自己的配置：<br><code># /usr/lib/systemd/system/multi-user.target</code>对应的目录位置<br><code>[Unit]</code> 定义了<code>unit</code>的基本信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Description：基本描述</span><br><span class="line">Documentation：对应的文档</span><br><span class="line">Requires：当前 unit 依赖的其他 unit，如果它们没有运行，当前 unit 会启动失败</span><br><span class="line">Conflicts：这里指定的 unit 不能与当前 unit 同时运行</span><br><span class="line">After：如果该字段指定的 unit 也要启动，那么必须在当前 unit 之前启动</span><br><span class="line">AllowIsolate：是否允许使用systemctl isolate命令切换到multi-user.target</span><br></pre></td></tr></table></figure>
<p>对于<code>multi-user.target</code>，基本描述和文档分别为<code>Description=Multi-User System</code>和<code>Documentation=man:systemd.special(7)</code>，<code>Requires=basic.target</code>表明需要同<code>basic.target</code>一起运行，<code>Conflicts=rescue.service rescue.target</code>表明和<code>rescue.service rescue.target</code>冲突不能一起运行，<code>After=basic.target rescue.service rescue.target</code>表明如果<code>basic.target和rescue.service rescue.target</code>要启动，<code>multi-user.target</code>需要在他们启动之后启动，<code>AllowIsolate=yes</code>表明允许使用<code>systemctl isolate</code>命令切换到<code>multi-user.target</code><br>在前面介绍了<code>Init</code>架构的运行级别，在<code>Systemd</code>架构中也存在类似的概念，主要是通过<code>Target</code>来定义系统的运行模式，对应的关系如下：</p>
<table>
<thead>
<tr>
<th align="center"><code>Init</code>架构运行等级</th>
<th align="center"><code>Systemd</code>架构的<code>Target</code></th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>0</code></td>
<td align="center"><code>runlevel0.target -&gt; poweroff.target</code></td>
<td align="center">关机</td>
</tr>
<tr>
<td align="center"><code>1</code></td>
<td align="center"><code>runlevel1.target -&gt; rescue.target</code></td>
<td align="center">单用户模式</td>
</tr>
<tr>
<td align="center"><code>2</code></td>
<td align="center"><code>runlevel2.target -&gt; multi-user.target</code></td>
<td align="center">断网多用户模式由联网多用户模式取代</td>
</tr>
<tr>
<td align="center"><code>3</code></td>
<td align="center"><code>runlevel3.target -&gt; multi-user.target</code></td>
<td align="center">联网多用户模式（默认）</td>
</tr>
<tr>
<td align="center"><code>4</code></td>
<td align="center"><code>runlevel4.target -&gt; multi-user.target</code></td>
<td align="center">联网多用户模式</td>
</tr>
<tr>
<td align="center"><code>5</code></td>
<td align="center"><code>runlevel5.target -&gt; graphical.target</code></td>
<td align="center">联网多用户模式且带有图形化界面</td>
</tr>
<tr>
<td align="center"><code>6</code></td>
<td align="center"><code>runlevel6.target -&gt; reboot.target</code></td>
<td align="center">重启系统</td>
</tr>
<tr>
<td align="center"><code>emergency</code></td>
<td align="center"><code>emergency.target</code></td>
<td align="center">紧急恢复状态</td>
</tr>
<tr>
<td align="center"><code>Systemd</code>默认启动的<code>Target</code>是<code>default.target</code>，而<code>default.target</code>是<code>multi-user.target</code>或<code>graphical.target</code>的软链接，可以通过<code>systemctl get-default</code>查询到。</td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www etc]# systemctl get-default</span><br><span class="line">multi-user.target</span><br></pre></td></tr></table></figure>
<h2 id="日志管理"><a href="#日志管理" class="headerlink" title="日志管理"></a>日志管理</h2><p><code>Systemd</code> 统一管理所有<code>Unit</code>的启动日志。我们可以只用<code>journalctl</code>一个命令，查看所有日志（内核日志和应用日志），其从<code>/var/log/messages</code>中获取日志信息，存放在<code>/run/log/journal/</code>下。配置文件是<code>/etc/systemd/journald.conf</code></p>
<h2 id="Systemd-的启动"><a href="#Systemd-的启动" class="headerlink" title="Systemd 的启动"></a>Systemd 的启动</h2><ol>
<li><p>当我们打开给Linux系统的电脑开机的时候，BIOS 会从非易失性存储器中加载，并执行上电自检，之后BIOS会检测系统资源，然后会查找硬盘的主引导记录（MBR），MBR会初始化引导程序如GRBU或者LILO。</p>
</li>
<li><p>MBR从GRBU或LILO引导程序读取相关信息并初始化内核。内核执行<code>Systemd</code>，之后的启动就交给<code>Systemd</code>了。<code>Systemd</code>使用<code>Target</code>来处理引导和服务管理过程。<code>Target</code>文件被用于分组不同的引导单元以及启动同步进程。</p>
</li>
<li><p><code>Systemd</code>执行的第一个<code>Target</code>是<code>default.target</code>，并递归的处理它的依赖关系，<code>default.target</code>实际上是指向<code>multi-user.target</code>或者<code>graphical.target</code>的软链接。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www ~]# systemctl cat default.target</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/usr/lib/systemd/system/multi-user.target</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> This file is part of systemd.</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment">#  systemd is free software; you can redistribute it and/or modify it</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> under the terms of the GNU Lesser General Public License as published by</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> the Free Software Foundation; either version 2.1 of the License, or</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"> (at your option) any later version.</span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Multi-User System</span><br><span class="line">Documentation=man:systemd.special(7)</span><br><span class="line">Requires=basic.target</span><br><span class="line">Conflicts=rescue.service rescue.target</span><br><span class="line">After=basic.target rescue.service rescue.target</span><br><span class="line">AllowIsolate=yes</span><br></pre></td></tr></table></figure></li>
<li><p>根据依赖关系，需要先启动<code>sysinit.target，basic.target</code>来初始化系统。</p>
</li>
<li><p><code>multi-user.target</code>会启动<code>/etc/systemd/system/multi-user.target.wants</code>下的服务，为多用户支持设定系统环境。非root用户会在这个阶段的引导过程中启用。防火墙相关的服务也会在这个阶段启动。利用这一点可以使得一些服务开机自动启动</p>
</li>
<li><p><code>Systemd</code>是可以兼容<code>Init</code>架构中的<code>rc.local</code>配置的，通过<code>rc-local.service</code>来实现兼容的，<code>Systemd</code>在启动的很早就会判断<code>/etc/rc.local</code>是否存在并且是可执行的，如果满足条件，那么<code>Systemd</code>会调用<code>/usr/lib/systemd/system-generators/</code>下的程序，把<code>rc-local.service</code>服务加入到<code>default.target</code>中来。这样在后面的执行时就会触发<code>rc.local</code>的运行，利用这一点我们可以实现程序的开机自动启动。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#################################### 启动流程图 #######################################</span></span></span><br><span class="line">                             cryptsetup-pre.target veritysetup-pre.target</span><br><span class="line">                                                  |</span><br><span class="line">(various low-level                                v</span><br><span class="line"> API VFS mounts:             (various cryptsetup/veritysetup devices...)</span><br><span class="line"> mqueue, configfs,                                |    |</span><br><span class="line"> debugfs, ...)                                    v    |</span><br><span class="line"> |                                  cryptsetup.target  |</span><br><span class="line"> |  (various swap                                 |    |    remote-fs-pre.target</span><br><span class="line"> |   devices...)                                  |    |     |        |</span><br><span class="line"> |    |                                           |    |     |        v</span><br><span class="line"> |    v                       local-fs-pre.target |    |     |  (network file systems)</span><br><span class="line"> |  swap.target                       |           |    v     v                 |</span><br><span class="line"> |    |                               v           |  remote-cryptsetup.target  |</span><br><span class="line"> |    |  (various low-level  (various mounts and  |  remote-veritysetup.target |</span><br><span class="line"> |    |   services: udevd,    fsck services...)   |             |              |</span><br><span class="line"> |    |   tmpfiles, random            |           |             |    remote-fs.target</span><br><span class="line"> |    |   seed, sysctl, ...)          v           |             |              |</span><br><span class="line"> |    |      |                 local-fs.target    |             | _____________/</span><br><span class="line"> |    |      |                        |           |             |/</span><br><span class="line"> \____|______|_______________   ______|___________/             |</span><br><span class="line">                             \ /                                |</span><br><span class="line">                              v                                 |</span><br><span class="line">                       sysinit.target                           |</span><br><span class="line">                              |                                 |</span><br><span class="line">       ______________________/|\_____________________           |</span><br><span class="line">      /              |        |      |               \          |</span><br><span class="line">      |              |        |      |               |          |</span><br><span class="line">      v              v        |      v               |          |</span><br><span class="line"> (various       (various      |  (various            |          |</span><br><span class="line">  timers...)      paths...)   |   sockets...)        |          |</span><br><span class="line">      |              |        |      |               |          |</span><br><span class="line">      v              v        |      v               |          |</span><br><span class="line">timers.target  paths.target   |  sockets.target      |          |</span><br><span class="line">      |              |        |      |               v          |</span><br><span class="line">      v              \_______ | _____/         rescue.service   |</span><br><span class="line">                             \|/                     |          |</span><br><span class="line">                              v                      v          |</span><br><span class="line">                          basic.target         rescue.target    |</span><br><span class="line">                              |                                 |</span><br><span class="line">                      ________v____________________             |</span><br><span class="line">                     /              |              \            |</span><br><span class="line">                     |              |              |            |</span><br><span class="line">                     v              v              v            |</span><br><span class="line">                 display-    (various system   (various system  |</span><br><span class="line">             manager.service     services        services)      |</span><br><span class="line">                     |         required for        |            |</span><br><span class="line">                     |        graphical UIs)       v            v</span><br><span class="line">                     |              |            multi-user.target</span><br><span class="line">emergency.service    |              |              |</span><br><span class="line">        |            \_____________ | _____________/</span><br><span class="line">        v                          \|/</span><br><span class="line">emergency.target                    v</span><br><span class="line">                              graphical.target</span><br></pre></td></tr></table></figure>
<p>关于Linux的开机启动可以参考：<a href="/2024/04/13/Linux%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B/" title="Linux的启动过程">Linux的启动过程</a></p>
</li>
</ol>
<h2 id="Systemd-相关的命令"><a href="#Systemd-相关的命令" class="headerlink" title="Systemd 相关的命令"></a>Systemd 相关的命令</h2><h3 id="系统相关"><a href="#系统相关" class="headerlink" title="系统相关"></a>系统相关</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## systemd ###</span></span></span><br><span class="line"></span><br><span class="line">systemctl --version #查看版本</span><br><span class="line"></span><br><span class="line">systemctl reboot #重启系统</span><br><span class="line"></span><br><span class="line">systemctl poweroff #关机</span><br><span class="line"></span><br><span class="line">systemctl halt #关机</span><br><span class="line"></span><br><span class="line">systemctl suspend #系统暂停</span><br><span class="line"></span><br><span class="line">systemd-analyze #查看启动耗时</span><br><span class="line"></span><br><span class="line">systemd-analyze plot &gt; boot.svg #将启动耗时图形化展示</span><br><span class="line"></span><br><span class="line">systemd-analyze blame #查看每个服务耗时</span><br><span class="line"></span><br><span class="line">systemd-analyze critical-chain #查看瀑布状启动过程</span><br><span class="line"></span><br><span class="line">systemd-analyze critical-chain sshd.service #查看指定服务的启动流</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## hostnamectl ###</span></span></span><br><span class="line"></span><br><span class="line">hostnamectl #查看主机</span><br><span class="line"></span><br><span class="line">hostnamectl set-hostname WWW #设置主机名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## localectl ###</span></span></span><br><span class="line"></span><br><span class="line">localectl #查看本地化设置</span><br><span class="line"></span><br><span class="line">localectl set-locale LANG=en_GB.utf8 # 设置本地化语言</span><br><span class="line"></span><br><span class="line">localectl set-keymap en_GB #设置本地化的键位图</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## timedatectl ###</span></span></span><br><span class="line"></span><br><span class="line">timedatectl #查看时间</span><br><span class="line"></span><br><span class="line">timedatectl list-timezones #显示当前可用时区</span><br><span class="line"></span><br><span class="line">timedatectl set-timezone America/New_York #设置当前时区</span><br><span class="line"></span><br><span class="line">timedatectl set-time YYYY-MM-DD #设置当前时间，年月日</span><br><span class="line"></span><br><span class="line">timedatectl set-time HH:MM:SS #设置当前时间，时分秒</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## loginctl ###</span></span></span><br><span class="line"></span><br><span class="line">loginctl list-sessions #列出当前session</span><br><span class="line"></span><br><span class="line">loginctl list-users #列出当前登录用户</span><br><span class="line"></span><br><span class="line">loginctl show-user root #列出指定用户信息</span><br></pre></td></tr></table></figure>
<h3 id="unit相关"><a href="#unit相关" class="headerlink" title="unit相关"></a>unit相关</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">man 5 systemd.slice #查看某种类型unit的文档</span><br><span class="line"></span><br><span class="line">systemctl list-units #列出正在运行的 unit</span><br><span class="line"></span><br><span class="line">systemctl list-units --all #列出所有的 unit，包括没有找到配置文件的或者启动失败的</span><br><span class="line"></span><br><span class="line">systemctl list-units --all --state=inactive #列出所有没有运行的 unit</span><br><span class="line"></span><br><span class="line">systemctl list-units --failed #列出所有加载失败的 unit</span><br><span class="line"></span><br><span class="line">systemctl list-units --type=service #列出所有正在运行的、类型为 service 的 unit</span><br><span class="line"></span><br><span class="line">systemctl status #显示系统状态</span><br><span class="line"></span><br><span class="line">systemctl status ssh.d.service #查看单个unit状态</span><br><span class="line"></span><br><span class="line">systemctl -H root@master status sshd.service #查看远程主机单个unit状态</span><br><span class="line"></span><br><span class="line">systemctl is-active sshd.service #查看某个unit是否运行</span><br><span class="line"></span><br><span class="line">systemctl is-failed sshd.service #查看某个unit是否启动失败</span><br><span class="line"></span><br><span class="line">systemctl is-enabled sshd.service #查看某个unit是否开机自动启动</span><br><span class="line"></span><br><span class="line">systemctl start sshd.service #启动某个unit</span><br><span class="line"></span><br><span class="line">systemctl stop sshd.service #停止某个unit</span><br><span class="line"></span><br><span class="line">systemctl restart sshd.service #重启某个unit</span><br><span class="line"></span><br><span class="line">systemctl enable sshd.service #设置某个unit开机自启</span><br><span class="line"></span><br><span class="line">systemctl enable sshd.service --now #设置某个unit开机自启，并重启</span><br><span class="line"></span><br><span class="line">systemctl status sshd.service #查看某个unit的运行状态</span><br><span class="line"></span><br><span class="line">systemctl disenable sshd.service #设置某个unit开机不自启</span><br><span class="line"></span><br><span class="line">systemctl kill sshd.service #杀掉该unit的所有子进程</span><br><span class="line"></span><br><span class="line">systemctl reload sshd.service #重新加载unit的配置文件</span><br><span class="line"></span><br><span class="line">systemctl daemon-reload #重载所有修改过的配置文件</span><br><span class="line"></span><br><span class="line">systemctl show sshd.service #显示某个unit的所有底层参数</span><br><span class="line"></span><br><span class="line">systemctl show -p CPUShares sshd.service #显示某个unit的指定属性的值</span><br><span class="line"></span><br><span class="line">systemctl set-property sshd.service CPUShares=500 #设置某个unit的指定属性</span><br><span class="line"></span><br><span class="line">systemctl list-dependencies sshd.service #列出unit的依赖关系，不显示Target</span><br><span class="line"></span><br><span class="line">systemctl list-dependencies --all sshd.service #列出unit的所有依赖关系</span><br><span class="line"></span><br><span class="line">systemctl list-unit-files #列出所有的unit配置文件，配置文件有状态有：enabled：开机自启，disenabled：开机不自启，static：该配置文件没有[Install]部分（无法执行），只能作为其他配置文件的依赖，masked：该配置文件被禁止建立启动链接</span><br><span class="line"></span><br><span class="line">systemctl list-unit-files --type=service #列出指定unit的配置文件</span><br><span class="line"></span><br><span class="line">systemctl list-units -t service --all #列出所有的指定unit的配置文件 -t就是type的意思</span><br><span class="line"></span><br><span class="line">systemctl cat sshd.service #查看某个配置文件</span><br><span class="line"></span><br><span class="line">systemctl edit sshd.service #编辑某个配置文件</span><br><span class="line"></span><br><span class="line">systemctl get-default #查看启动时的默认Target</span><br><span class="line"></span><br><span class="line">systemctl set-default multi-user.target #设置默认启动的Target</span><br><span class="line"></span><br><span class="line">systemctl isolate multi-user.target #切换 Target 时，关闭前一个 Target 里面所有不属于后一个 Target 的进程，默认不关闭前一个 Target 启动的进程</span><br></pre></td></tr></table></figure>
<h3 id="日志相关"><a href="#日志相关" class="headerlink" title="日志相关"></a>日志相关</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">journalctl #查看日志，默认只保存本次启动的日志</span><br><span class="line"></span><br><span class="line">journalctl -k #查看内核日志，不显示应用日志</span><br><span class="line"></span><br><span class="line">journalctl -b # 查看系统本次启动的日志</span><br><span class="line">journalctl -b -0</span><br><span class="line"></span><br><span class="line">journalctl -b -1 # 查看系统上次启动的日志，需要修改配置文件，保存上次启动的日志</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看指定时间的日志</span></span><br><span class="line">journalctl --since=&quot;2020-10-1 15:16:17&quot;</span><br><span class="line">journalctl --since &quot;30 min ago&quot;</span><br><span class="line">journalctl --since yesterday</span><br><span class="line">journalctl --since &quot;2020-03-12&quot; --until &quot;2024-03-13 05:00&quot;</span><br><span class="line">journalctl --since 10:00 --until &quot;2 hour ago&quot;</span><br><span class="line"></span><br><span class="line">journalctl -n # 显示尾部的最新10行日志</span><br><span class="line"></span><br><span class="line">journalctl -n 20 # 显示尾部指定行数的日志</span><br><span class="line"></span><br><span class="line">journalctl -f # 实时滚动显示最新日志</span><br><span class="line"></span><br><span class="line">journalctl /usr/lib/systemd/systemd # 查看指定服务的日志</span><br><span class="line"></span><br><span class="line">journalctl _PID=1 #查看指定进程的日志</span><br><span class="line"></span><br><span class="line">journalctl /usr/bin/bash # 查看某个路径的脚本的日志</span><br><span class="line"></span><br><span class="line">journalctl _UID=33 --since today # 查看指定用户的日志</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看某个 unit 的日志</span></span><br><span class="line">journalctl -u sshd.service</span><br><span class="line">journalctl -u sshd.service --since today</span><br><span class="line"></span><br><span class="line">journalctl -u sshd.service -f # 实时滚动显示某个 Unit 的最新日志</span><br><span class="line"></span><br><span class="line">journalctl -u nginx.service -u php-fpm.service --since today # 合并显示多个 Unit 的日志</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看指定优先级（及其以上级别）的日志，共有8级</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">0: emerg</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1: alert</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2: crit</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3: err</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4: warning</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5: notice</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">6: info</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">7: debug</span></span><br><span class="line">journalctl -p err -b</span><br><span class="line"></span><br><span class="line">journalctl --no-pager # 日志默认分页输出，--no-pager 改为正常的标准输出</span><br><span class="line"></span><br><span class="line">journalctl -b -u sshd.service -o json # 以 JSON 格式（单行）输出</span><br><span class="line"></span><br><span class="line">journalctl -b -u sshd.service -o json-pretty # 以 JSON 格式（多行）输出，可读性更好</span><br><span class="line"></span><br><span class="line">journalctl --disk-usage # 显示日志占据的硬盘空间</span><br><span class="line"></span><br><span class="line">journalctl --vacuum-size=1G # 指定日志文件占据的最大空间</span><br><span class="line"></span><br><span class="line">journalctl --vacuum-time=1years # 指定日志文件保存多久</span><br></pre></td></tr></table></figure>
<h3 id="systemd"><a href="#systemd" class="headerlink" title="systemd-"></a>systemd-</h3><p>通过在终端输入<code>systemd-</code>，然后Tab补全就可以查看相应的命令，这些命令是<code>systemd</code>架构提供的可用命令，平时很少用到。</p>
<h2 id="创建自己的Service"><a href="#创建自己的Service" class="headerlink" title="创建自己的Service"></a>创建自己的Service</h2><ol>
<li>创建配置文件<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /etc/systemd/system/hello.service</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">### 文件内容</span></span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Hello</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=/usr/bin/python /root/hello.py</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></li>
<li>创建<code>python</code>脚本文件<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim /root/hello.py</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">### 脚本内容</span></span></span><br><span class="line">import logging</span><br><span class="line">import time</span><br><span class="line">logging.basicConfig(format=&#x27;Date-Time : %(asctime)s : Line No. : %(lineno)d - %(message)s&#x27;, level = logging.DEBUG)</span><br><span class="line">while True:</span><br><span class="line">	logging.debug(&quot;A Debug logging Message&quot;)</span><br><span class="line">	time.sleep(10)</span><br></pre></td></tr></table></figure></li>
<li>启动服务，并设置开机自启<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl daemon-reload # 编写后需要重新加载新的配置文件</span><br><span class="line">systemctl start hello.service #启动服务</span><br><span class="line">systemctl enable hello.service #设置开机自动启动</span><br><span class="line">systemctl status hello.service #查看状态</span><br><span class="line"></span><br><span class="line">[root@www ~]# systemctl status hello.service -l</span><br><span class="line">● hello.service - Hello</span><br><span class="line">   Loaded: loaded (/etc/systemd/system/hello.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Sun 2024-04-14 11:27:37 CST; 2min 17s ago</span><br><span class="line"> Main PID: 8128 (python)</span><br><span class="line">   CGroup: /system.slice/hello.service</span><br><span class="line">           └─8128 /usr/bin/python /root/hello.py</span><br><span class="line"></span><br><span class="line">Apr 14 11:28:17 www.a.org python[8128]: Date-Time : 2024-04-14 11:28:17,540 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:28:27 www.a.org python[8128]: Date-Time : 2024-04-14 11:28:27,549 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:28:37 www.a.org python[8128]: Date-Time : 2024-04-14 11:28:37,580 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:28:47 www.a.org python[8128]: Date-Time : 2024-04-14 11:28:47,612 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:28:57 www.a.org python[8128]: Date-Time : 2024-04-14 11:28:57,619 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:29:07 www.a.org python[8128]: Date-Time : 2024-04-14 11:29:07,638 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:29:17 www.a.org python[8128]: Date-Time : 2024-04-14 11:29:17,642 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:29:27 www.a.org python[8128]: Date-Time : 2024-04-14 11:29:27,701 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:29:37 www.a.org python[8128]: Date-Time : 2024-04-14 11:29:37,728 : Line No. : 5 - A Debug logging Message</span><br><span class="line">Apr 14 11:29:47 www.a.org python[8128]: Date-Time : 2024-04-14 11:29:47,737 : Line No. : 5 - A Debug logging Message</span><br><span class="line"></span><br><span class="line">systemctl restart hello #重启服务</span><br><span class="line">ps aux | grep hello #查看进程</span><br><span class="line">[root@www ~]# ps aux | grep hello</span><br><span class="line">root      8347  0.0  0.2 138728  5404 ?        Ss   11:31   0:00 /usr/bin/python /root/hello.py</span><br><span class="line">root      8373  0.0  0.0 112812   976 pts/0    S+   11:31   0:00 grep --color=auto hello</span><br><span class="line"></span><br><span class="line">systemctl stop hello #停止服务</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-commands.html" title="Systemd 入门教程：命令篇">Systemd 入门教程：命令篇</a></li>
<li><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/03/systemd-tutorial-part-two.html" title="Systemd 入门教程：实战篇">Systemd 入门教程：实战篇</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/643259265?utm_campaign=shareopn&utm_medium=social&utm_psn=1762514603320569856&utm_source=wechat_session" title="《一篇搞懂》系列之三——systemd">《一篇搞懂》系列之三——systemd</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freedesktop.org/software/systemd/man/latest/systemd.unit.html" title="systemd.unit — Unit configuration">systemd.unit — Unit configuration</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.fedoraproject.org/en-US/quick-docs/systemd-understanding-and-administering/" title="Understanding and administering systemd">Understanding and administering systemd</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freedesktop.org/software/systemd/man/latest/bootup.html" title="bootup — System bootup process">bootup — System bootup process</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freedesktop.org/wiki/Software/systemd/" title="systemd手册">systemd手册</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/kaikai136412162/article/details/105702912" title="Systemd的Unit文件； systemctl自定义服务启动">Systemd的Unit文件； systemctl自定义服务启动</a></li>
<li><a target="_blank" rel="noopener" href="https://linux.cn/article-5457-1.html" title="走进Linux之systemd启动过程">走进Linux之systemd启动过程</a></li>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Tz4y1s7QW/?spm_id_from=333.337.search-card.all.click&vd_source=4470be84aba61145fe9d1690fe726951" title="Linux Systemd完全入门 一个视频搞懂systemd的使用">Linux Systemd完全入门 一个视频搞懂systemd的使用</a></li>
<li><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/621298905/answer/3464947964?utm_campaign=shareopn&utm_medium=social&utm_psn=1762764177159254017&utm_source=wechat_session" title="LINUX启动流程是怎么样的？">LINUX启动流程是怎么样的？</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/rikeyone/article/details/108097837" title="systemd启动流程分析">systemd启动流程分析</a></li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://haharcher1.github.io">爱吃铜锣烧的哆啦酱</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://haharcher1.github.io/2024/04/13/Linux%E7%9A%84Syetemd%E6%9C%8D%E5%8A%A1/">https://haharcher1.github.io/2024/04/13/Linux%E7%9A%84Syetemd%E6%9C%8D%E5%8A%A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://haharcher1.github.io" target="_blank">哆啦酱的点心屋</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images0b5f3510de09418d98baaedffe1a7f3b.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/14/Centos%E8%AE%BE%E7%BD%AE%E5%BC%80%E6%9C%BA%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8/" title="Centos设置开机自动启动"><img class="cover" src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images6d2d2a3e8c424cc4acbf73b458febc7e.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Centos设置开机自动启动</div></div></a></div><div class="next-post pull-right"><a href="/2024/04/13/Centos%E4%B8%AD%E7%9A%84%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" title="Centos中的环境变量"><img class="cover" src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images46785555990c4b209fb8495463fa7f69.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Centos中的环境变量</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/03/20/Centos8-stream%E5%AE%89%E8%A3%85VASP-2024-Intel-oneAPI/" title="Centos8 stream安装VASP--2024 Intel oneAPI"><img class="cover" src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_imagesa9982f7441bd4e07a3b1a26af43457d9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-20</div><div class="title">Centos8 stream安装VASP--2024 Intel oneAPI</div></div></a></div><div><a href="/2024/03/28/Centos8%E9%9B%86%E7%BE%A4Slurm%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89/" title="Centos8集群Slurm作业管理系统安装（一）"><img class="cover" src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images61ac5e440dac4d97a6624e05044c4074.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-28</div><div class="title">Centos8集群Slurm作业管理系统安装（一）</div></div></a></div><div><a href="/2024/03/28/Centos8%E9%9B%86%E7%BE%A4Slurm%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%89%EF%BC%89/" title="Centos8集群Slurm作业管理系统安装（三）"><img class="cover" src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images96b26df8437c44e899f67d2fee4777ae.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-28</div><div class="title">Centos8集群Slurm作业管理系统安装（三）</div></div></a></div><div><a href="/2024/03/28/Centos8%E9%9B%86%E7%BE%A4Slurm%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%EF%BC%88%E4%BA%8C%EF%BC%89/" title="Centos8集群Slurm作业管理系统安装（二）"><img class="cover" src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images6a17c887d6054e798c9c88f4ca76f932.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-28</div><div class="title">Centos8集群Slurm作业管理系统安装（二）</div></div></a></div><div><a href="/2024/04/17/Centos8%E9%9B%86%E7%BE%A4Slurm%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%EF%BC%88%E5%9B%9B%EF%BC%89/" title="Centos8集群Slurm作业管理系统安装（四）"><img class="cover" src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_imagesf602c9a47f444b4fad817c9a066266c9.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-17</div><div class="title">Centos8集群Slurm作业管理系统安装（四）</div></div></a></div><div><a href="/2024/03/22/Centos8%E9%9B%86%E7%BE%A4Torque%E4%BD%9C%E4%B8%9A%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89/" title="Centos8集群Torque作业管理系统安装（一）"><img class="cover" src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images7e4afde0d80946dea5898e2dfa559b81.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-22</div><div class="title">Centos8集群Torque作业管理系统安装（一）</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">爱吃铜锣烧的哆啦酱</div><div class="author-info__description">好饿好饿好饿，我真的好饿！</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">39</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">25</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/hahArcher1"><i class="fab fa-github"></i><span>订阅我</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/hahArcher1" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到哆啦酱的点心屋！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Init%E6%9E%B6%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">Init架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BF%90%E8%A1%8C%E7%BA%A7%E5%88%AB"><span class="toc-number">2.1.</span> <span class="toc-text">系统的运行级别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Init%E6%9E%B6%E6%9E%84%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.2.</span> <span class="toc-text">Init架构的服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Init%E6%9E%B6%E6%9E%84%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="toc-number">2.3.</span> <span class="toc-text">Init架构的启动</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Systemd%E6%9E%B6%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">Systemd架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Systemd-unit"><span class="toc-number">3.1.</span> <span class="toc-text">Systemd unit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unit-%E5%88%86%E7%B1%BB"><span class="toc-number">3.2.</span> <span class="toc-text">unit 分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#unit-%E7%9A%84%E5%AD%98%E6%94%BE%E8%B7%AF%E5%BE%84"><span class="toc-number">3.3.</span> <span class="toc-text">unit 的存放路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84unit"><span class="toc-number">3.4.</span> <span class="toc-text">常用的unit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Service-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.4.1.</span> <span class="toc-text">Service 简单介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Target-%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.4.2.</span> <span class="toc-text">Target 简单介绍</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="toc-number">3.5.</span> <span class="toc-text">日志管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Systemd-%E7%9A%84%E5%90%AF%E5%8A%A8"><span class="toc-number">3.6.</span> <span class="toc-text">Systemd 的启动</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Systemd-%E7%9B%B8%E5%85%B3%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">3.7.</span> <span class="toc-text">Systemd 相关的命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3"><span class="toc-number">3.7.1.</span> <span class="toc-text">系统相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#unit%E7%9B%B8%E5%85%B3"><span class="toc-number">3.7.2.</span> <span class="toc-text">unit相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%9B%B8%E5%85%B3"><span class="toc-number">3.7.3.</span> <span class="toc-text">日志相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#systemd"><span class="toc-number">3.7.4.</span> <span class="toc-text">systemd-</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84Service"><span class="toc-number">3.8.</span> <span class="toc-text">创建自己的Service</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">4.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/04/26/github%E5%8A%A0hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%EF%BC%88%E5%85%AB%EF%BC%89/" title="github加hexo搭建个人博客（八）"><img src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_imagescdaeae4a20fa405b8e9b7d4aac50f7b5.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="github加hexo搭建个人博客（八）"/></a><div class="content"><a class="title" href="/2024/04/26/github%E5%8A%A0hexo%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%EF%BC%88%E5%85%AB%EF%BC%89/" title="github加hexo搭建个人博客（八）">github加hexo搭建个人博客（八）</a><time datetime="2024-04-26T11:11:13.000Z" title="发表于 2024-04-26 19:11:13">2024-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E6%95%B0%E5%AD%97/" title="计算机组成原理——数字"><img src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images509ea1ea46464dbe8390c60702de287f.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机组成原理——数字"/></a><div class="content"><a class="title" href="/2024/04/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E6%95%B0%E5%AD%97/" title="计算机组成原理——数字">计算机组成原理——数字</a><time datetime="2024-04-23T15:14:30.000Z" title="发表于 2024-04-23 23:14:30">2024-04-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%B3%BB%E7%BB%9F/" title="计算机组成原理——输入输出系统"><img src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images9ac16f1fbe5d40168ab4442d07049f05.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机组成原理——输入输出系统"/></a><div class="content"><a class="title" href="/2024/04/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E7%B3%BB%E7%BB%9F/" title="计算机组成原理——输入输出系统">计算机组成原理——输入输出系统</a><time datetime="2024-04-23T08:01:59.000Z" title="发表于 2024-04-23 16:01:59">2024-04-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E5%AD%98%E5%82%A8%E5%99%A82/" title="计算机组成原理——存储器2"><img src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_images03c589e10bc6490e8f3cc6423a42ac65.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机组成原理——存储器2"/></a><div class="content"><a class="title" href="/2024/04/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E5%AD%98%E5%82%A8%E5%99%A82/" title="计算机组成原理——存储器2">计算机组成原理——存储器2</a><time datetime="2024-04-22T13:55:18.000Z" title="发表于 2024-04-22 21:55:18">2024-04-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E5%AD%98%E5%82%A8%E5%99%A8/" title="计算机组成原理——存储器"><img src="https://raw.githubusercontent.com/hahArcher1/blog_picture/main/cover_imagesb20ef7ed80304190a81162b1b5036343.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机组成原理——存储器"/></a><div class="content"><a class="title" href="/2024/04/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86%E2%80%94%E2%80%94%E5%AD%98%E5%82%A8%E5%99%A8/" title="计算机组成原理——存储器">计算机组成原理——存储器</a><time datetime="2024-04-21T06:41:08.000Z" title="发表于 2024-04-21 14:41:08">2024-04-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2024 By 爱吃铜锣烧的哆啦酱</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">欢迎来到哆啦酱的点心屋！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(() => {
  const initGitalk = () => {
    const gitalk = new Gitalk(Object.assign({
      clientID: '1e6e2f537e19cc631780',
      clientSecret: '247d7fcfdc71454a3a9dba4ae26d333c83219710',
      repo: 'hahArcher1.github.io',
      owner: 'hahArcher1',
      admin: ['hahArcher1'],
      id: 'a41472cc1a1747d89a2917e73ffe0b3d',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  const loadGitalk = async() => {
    if (typeof Gitalk === 'function') initGitalk()
    else {
      await getCSS('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.css')
      await getScript('https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js')
      initGitalk()
    }
  }
  
  const commentCount = n => {
    const isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
    if (isCommentCount) {
      isCommentCount.textContent= n
    }
  }

  if ('Gitalk' === 'Gitalk' || !true) {
    if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
    else loadGitalk()
  } else {
    window.loadOtherComment = loadGitalk
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>